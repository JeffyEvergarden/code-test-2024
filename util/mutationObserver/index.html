<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MutationObserver API æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 28px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-add {
            background: #4CAF50;
            color: white;
        }

        .btn-add:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }

        .btn-remove {
            background: #f44336;
            color: white;
        }

        .btn-remove:hover {
            background: #da190b;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(244, 67, 54, 0.3);
        }

        .btn-clear {
            background: #2196F3;
            color: white;
        }

        .btn-clear:hover {
            background: #0b7dda;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(33, 150, 243, 0.3);
        }

        .btn-clear-logs {
            background: #FF9800;
            color: white;
        }

        .btn-clear-logs:hover {
            background: #e68900;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(255, 152, 0, 0.3);
        }

        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }
        }

        .observed-container {
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 20px;
            min-height: 300px;
            background: #f8f9fa;
        }

        .observed-container h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideIn 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .item-removing {
            animation: slideOut 0.3s ease;
        }

        @keyframes slideOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(20px);
            }
        }

        .logs-container {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            background: #f8f9fa;
            max-height: 500px;
            overflow-y: auto;
        }

        .logs-container h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .log-item {
            padding: 10px;
            margin: 8px 0;
            border-radius: 4px;
            border-left: 4px solid;
            background: white;
            font-size: 14px;
            line-height: 1.5;
        }

        .log-added {
            border-left-color: #4CAF50;
            background: #e8f5e9;
        }

        .log-removed {
            border-left-color: #f44336;
            background: #ffebee;
        }

        .log-attribute {
            border-left-color: #2196F3;
            background: #e3f2fd;
        }

        .log-text {
            border-left-color: #FF9800;
            background: #fff3e0;
        }

        .timestamp {
            color: #666;
            font-size: 12px;
            margin-top: 4px;
        }

        .empty-state {
            text-align: center;
            color: #999;
            padding: 40px;
            font-style: italic;
        }

        .stats {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: #f0f0f0;
            padding: 12px 20px;
            border-radius: 6px;
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” MutationObserver API æµ‹è¯•é¡µé¢</h1>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-label">å½“å‰å…ƒç´ æ•°é‡</div>
                <div class="stat-value" id="elementCount">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">è§‚å¯Ÿåˆ°çš„å˜åŒ–</div>
                <div class="stat-value" id="changeCount">0</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn-add" onclick="addElement()">â• æ·»åŠ å…ƒç´ </button>
            <button class="btn-remove" onclick="removeElement()">â– åˆ é™¤å…ƒç´ </button>
            <button class="btn-clear" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰å…ƒç´ </button>
            <button class="btn-clear-logs" onclick="clearLogs()">ğŸ“‹ æ¸…ç©ºæ—¥å¿—</button>
        </div>

        <div class="content-wrapper">
            <div class="observed-container">
                <h2>è¢«è§‚å¯Ÿçš„å®¹å™¨</h2>
                <div id="targetContainer">
                    <div class="empty-state">ç‚¹å‡»"æ·»åŠ å…ƒç´ "æŒ‰é’®å¼€å§‹æµ‹è¯•</div>
                </div>
            </div>

            <div class="logs-container">
                <h2>MutationObserver æ—¥å¿—</h2>
                <div id="logs"></div>
            </div>
        </div>
    </div>

    <script>
        let elementCounter = 0;
        let changeCounter = 0;
        const targetContainer = document.getElementById('targetContainer');
        const logsContainer = document.getElementById('logs');
        const elementCountEl = document.getElementById('elementCount');
        const changeCountEl = document.getElementById('changeCount');

        // åˆ›å»º MutationObserver å®ä¾‹
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                changeCounter++;
                changeCountEl.textContent = changeCounter;
                console.log('mutation: ', mutation);
                // å¤„ç†å­èŠ‚ç‚¹çš„æ·»åŠ 
                if (mutation.type === 'childList') {
                    mutation.addedNodes.forEach((node) => {
                        if (node.nodeType === Node.ELEMENT_NODE) {
                            console.log('æ·»åŠ äº†å…ƒç´ : ', node);
                            addLog('added', `âœ… æ·»åŠ äº†å…ƒç´ : ${node.textContent.trim() || node.tagName}`, mutation);
                        } else if (node.nodeType === Node.TEXT_NODE && node.textContent.trim()) {
                            addLog('text', `ğŸ“ æ·»åŠ äº†æ–‡æœ¬èŠ‚ç‚¹: "${node.textContent.trim()}"`, mutation);
                        }
                    });

                    mutation.removedNodes.forEach((node) => {
                        if (node.nodeType === Node.ELEMENT_NODE) {
                            addLog('removed', `âŒ åˆ é™¤äº†å…ƒç´ : ${node.textContent.trim() || node.tagName}`, mutation);
                        } else if (node.nodeType === Node.TEXT_NODE && node.textContent.trim()) {
                            addLog('text', `ğŸ“ åˆ é™¤äº†æ–‡æœ¬èŠ‚ç‚¹: "${node.textContent.trim()}"`, mutation);
                        }
                    });
                }

                // å¤„ç†å±æ€§å˜åŒ–
                if (mutation.type === 'attributes') {
                    const attributeName = mutation.attributeName;
                    const oldValue = mutation.oldValue;
                    const newValue = mutation.target.getAttribute(attributeName);
                    addLog('attribute', `ğŸ”§ å±æ€§ "${attributeName}" å˜åŒ–: "${oldValue}" â†’ "${newValue}"`, mutation);
                }

                // å¤„ç†æ–‡æœ¬å†…å®¹å˜åŒ–
                if (mutation.type === 'characterData') {
                    addLog('text', `ğŸ“ æ–‡æœ¬å†…å®¹å˜åŒ–: "${mutation.oldValue}" â†’ "${mutation.target.textContent}"`, mutation);
                }
            });
        });

        // å¼€å§‹è§‚å¯Ÿ
        observer.observe(targetContainer, {
            childList: true,        // è§‚å¯Ÿå­èŠ‚ç‚¹çš„æ·»åŠ å’Œåˆ é™¤
            subtree: true,          // è§‚å¯Ÿæ‰€æœ‰åä»£èŠ‚ç‚¹
            attributes: true,      // è§‚å¯Ÿå±æ€§å˜åŒ–
            attributeOldValue: true, // è®°å½•å±æ€§çš„æ—§å€¼
            characterData: true,    // è§‚å¯Ÿæ–‡æœ¬å†…å®¹å˜åŒ–
            characterDataOldValue: true // è®°å½•æ–‡æœ¬çš„æ—§å€¼
        });

        // æ·»åŠ æ—¥å¿—
        function addLog(type, message, mutation) {
            const logItem = document.createElement('div');
            logItem.className = `log-item log-${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            logItem.innerHTML = `
                <div>${message}</div>
                <div class="timestamp">æ—¶é—´: ${timestamp} | ç±»å‹: ${mutation.type}</div>
            `;
            
            logsContainer.insertBefore(logItem, logsContainer.firstChild);
            
            // é™åˆ¶æ—¥å¿—æ•°é‡ï¼Œæœ€å¤šä¿ç•™100æ¡
            while (logsContainer.children.length > 100) {
                logsContainer.removeChild(logsContainer.lastChild);
            }
        }

        // æ·»åŠ å…ƒç´ 
        function addElement() {
            elementCounter++;
            const item = document.createElement('div');
            item.className = 'item';
            item.setAttribute('data-id', elementCounter);
            item.textContent = `å…ƒç´  #${elementCounter}`;
            
            // å¦‚æœå®¹å™¨æ˜¯ç©ºçš„ï¼ˆåªæœ‰æç¤ºæ–‡å­—ï¼‰ï¼Œå…ˆæ¸…ç©º
            if (targetContainer.children.length === 1 && 
                targetContainer.children[0].classList.contains('empty-state')) {
                targetContainer.innerHTML = '';
            }
            
            targetContainer.appendChild(item);
            updateElementCount();
        }

        // åˆ é™¤å…ƒç´ 
        function removeElement() {
            const items = targetContainer.querySelectorAll('.item');
            if (items.length > 0) {
                const lastItem = items[items.length - 1];
                lastItem.classList.add('item-removing');
                setTimeout(() => {
                    lastItem.remove();
                    updateElementCount();
                }, 300);
            } else {
                if (targetContainer.children.length === 0) {
                    targetContainer.innerHTML = '<div class="empty-state">ç‚¹å‡»"æ·»åŠ å…ƒç´ "æŒ‰é’®å¼€å§‹æµ‹è¯•</div>';
                }
            }
        }

        // æ¸…ç©ºæ‰€æœ‰å…ƒç´ 
        function clearAll() {
            const items = targetContainer.querySelectorAll('.item');
            items.forEach((item, index) => {
                setTimeout(() => {
                    item.classList.add('item-removing');
                    setTimeout(() => item.remove(), 300);
                }, index * 50);
            });
            
            setTimeout(() => {
                if (targetContainer.children.length === 0) {
                    targetContainer.innerHTML = '<div class="empty-state">ç‚¹å‡»"æ·»åŠ å…ƒç´ "æŒ‰é’®å¼€å§‹æµ‹è¯•</div>';
                }
                updateElementCount();
            }, items.length * 50 + 300);
        }

        // æ¸…ç©ºæ—¥å¿—
        function clearLogs() {
            logsContainer.innerHTML = '';
            changeCounter = 0;
            changeCountEl.textContent = '0';
        }

        // æ›´æ–°å…ƒç´ è®¡æ•°
        function updateElementCount() {
            const count = targetContainer.querySelectorAll('.item').length;
            elementCountEl.textContent = count;
        }

        // åˆå§‹åŒ–
        updateElementCount();
        addLog('text', 'ğŸš€ MutationObserver å·²å¯åŠ¨ï¼Œå¼€å§‹è§‚å¯Ÿ DOM å˜åŒ–', { type: 'init' });
    </script>
</body>
</html>
